# Readme

[toc]



该文件夹随着每个项目绘制和售后信息的增加，已经非常大，决定采用向NAS备份的手段进行双备份。 2025-9-16





## SMB/CIFS 协议简介

- 全称：**Server Message Block / Common Internet File System**。
- 主要用途：**局域网文件共享**，Windows 系统原生支持。
- 传输方式：基于 TCP 445 端口（老版本兼容 139 端口）。
- 体验：连接后 NAS 会直接映射成电脑里的一个磁盘分区，可以像本地文件夹一样读写。

Windows PowerShell/命令行可以使用：

```powershell
robocopy D:\MyFolder Z:\Backup /MIR
```

也可直接使用 `copy`、`xcopy` 等命令。



## robocopy

`robocopy` 的目录参数可以写相对路径，也可以是绝对路径，并且**会自动创建目标文件夹**（包括多级子文件夹），无需手动提前建目录。下面详细说明：

### 1️⃣ 支持相对路径

- **相对路径写法**
   在当前命令行工作目录下执行：

  ```
  robocopy .\MyFolder Z:\Backup /MIR
  ```

  这里 `.\MyFolder` 就是相对路径。

- 注意：相对路径是**相对于当前 PowerShell / CMD 所在目录**的，比如 `cd D:\Work` 后执行，`.\MyFolder` 实际指 `D:\Work\MyFolder`。

### 2️⃣ 自动创建目标文件夹

- `robocopy` 的目标参数如果不存在，会**自动创建整个目录树**。

- 例如：

  ```
  robocopy D:\Data Z:\NewFolder\SubFolder /MIR
  ```

  即便 `Z:\NewFolder` 和 `Z:\NewFolder\SubFolder` 都不存在，也会在 NAS 上自动创建它们。

### 3️⃣ `/MIR` 参数作用

- `/MIR` = **Mirror**，会让目标目录成为源目录的镜像：

  - 如果源目录删除了文件，目标目录也会删除相应文件。
  - 适用于备份或同步，但请谨慎使用，以免误删重要文件。

- 如果只是想“有就更新，没有就新增”而不删除，可以用：

  ```
  /E
  ```

  `/E` 会复制所有子目录（包括空目录），但不会删除目标中多余的文件。

### 4️⃣ 常见用法示例

```powershell
# 从当前目录下的Upload文件夹同步到NAS的Backup

robocopy .\ Z:\8.产品市场部\1.部门共享\技服组\交接文档\许剑锋\1.售前\3.业务报备项目档案 /MIR /LOG:D:\log.txt
```

<img src=".\img\image-20250916115056336.png" alt="image-20250916115056336" style="zoom:67%;" />

注意： 该命令会把**业务报备项目档案**案 完全清空再覆盖，谨慎操作





## 参数解释

### 1️⃣ 源目录 `.\`

- `.\` 表示当前命令行工作目录本身的所有内容。

- 如果你想同步当前目录下的 **Upload** 文件夹，而不是当前目录的所有内容，应写成：

  ```
  robocopy .\Upload Z:\8.产品市场部\1.部门共享\技服组\交接文档\许剑锋\1.售前\3.业务报备项目档案 /MIR /LOG:D:\log.txt
  ```

### 2️⃣ 目标路径

- `Z:\8.产品市场部\1.部门共享\技服组\交接文档\许剑锋\1.售前\3.业务报备项目档案`

  - 路径中包含空格和中文字符，没有问题，但**建议整体加引号**以避免因空格导致解析错误：

  ```
  robocopy .\Upload "Z:\8.产品市场部\1.部门共享\技服组\交接文档\许剑锋\1.售前\3.业务报备项目档案" /MIR /LOG:D:\log.txt
  ```

### 3️⃣ 自动创建目录

- 目标目录即便不存在，`robocopy` 会自动创建整个多级路径，无需提前在 NAS 上手动建文件夹。

### 4️⃣ `/MIR` 参数

- 会严格镜像源目录：删除目标中源目录里已删除的文件。
- 如果只想**增量更新**，可以用 `/E` 代替 `/MIR`，避免误删目标文件。

### 5️⃣ 日志

- `/LOG:D:\log.txt` 会把同步结果输出到 `D:\log.txt` 文件里，方便查看。

------

✅ **推荐完整写法（增量更新示例）**

```
robocopy .\ "Z:\8.产品市场部\1.部门共享\技服组\交接文档\许剑锋\1.售前\3.业务报备项目档案" /E /LOG:D:\log.txt
```

如果需要完全镜像，则保留 `/MIR`：

```
robocopy .\Upload "Z:\8.产品市场部\1.部门共享\技服组\交接文档\许剑锋\1.售前\3.业务报备项目档案" /MIR /LOG:D:\log.txt
```

这样可以保证：

- 自动创建 NAS 端的多级文件夹
- 处理中文和空格不会报错
- 日志写入指定文件





## Reference

1.  https://chatgpt.com/c/68c37299-9c58-832b-95bf-13597312ab03
2. https://chatgpt.com/c/68c376ab-ee98-8324-bee1-7f97cd314dc1